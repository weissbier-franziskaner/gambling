<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt; &lt;html lang="de"&gt; &lt;head&gt; &lt;meta charset="UTF-8"&gt; &lt;meta name="viewport"content="width=device-width, initial-scale=1.0"&gt; &lt;title id="pageTitle"&gt;Spiele-Ranglisten&lt;/title&gt; &lt;scriptsrc="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"&gt;&lt;/script&gt; &lt;scriptsrc="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"&gt;&lt;/script&gt; &lt;scriptsrc="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"&gt;&lt;/script&gt; &lt;style&gt; /* CSS für Styling und Layout */ body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background-color: #f4f7f6; color: #333; line-height: 1.6; } header { background-color: #2c3e50; color: #ecf0f1; padding: 20px 0;text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); } header h1 { margin: 0; font-size: 2.5em; } nav { margin-top: 10px; } .back-button { display: inline-block; background-color: #3498db; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; transition: background-color 0.3s ease; } .back-button:hover { background-color: #2980b9; } main { padding: 20px; max-width: 1200px; margin: 20px auto; background-color: #fff; border-radius: 8px;box-shadow: 0 0 10px rgba(0,0,0,0.1); } section { margin-bottom: 40px; } h2 { color: #2c3e50; border-bottom: 2pxsolid #3498db; padding-bottom: 10px; margin-bottom: 20px; } .category-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; } .category-card { background-color: #ecf0f1;border: 1px solid #ddd; border-radius: 8px; padding: 20px; text-align: center; text-decoration: none; color: #333;transition: transform 0.2s ease, box-shadow 0.2s ease; display: flex; flex-direction: column; justify-content: center;align-items: center; } .category-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }.category-card h3 { color: #3498db; margin-top: 0; font-size: 1.8em; } table { width: 100%; border-collapse: collapse;margin-top: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); } table th, table td { padding: 12px 15px; text-align: left;border-bottom: 1px solid #ddd; } table th { background-color: #3498db; color: white; text-transform: uppercase; font-weight: bold; } table tbody tr:nth-child(even) { background-color: #f9f9f9; } table tbody tr:hover { background-color: #f1f1f1; } .admin-section { background-color: #e8f4f8; padding: 25px; border-radius: 8px; border: 1px solid #d0e7f0;margin-top: 30px; } .admin-login, #addGameForm { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; } label { font-weight: bold; color: #2c3e50; margin-bottom: 5px; } input[type="password"], select { padding: 10px;border: 1px solid #ccc; border-radius: 5px; font-size: 1em; width: 100%; box-sizing: border-box; } button {background-color: #28a745; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 1.1em; transition: background-color 0.3s ease; } button:hover { background-color: #218838; } .error-message {color: #dc3545; font-size: 0.9em; margin-top: 5px; } .success-message { color: #28a745; font-size: 0.9em; margin-top: 5px; } footer { text-align: center; padding: 20px; margin-top: 40px; background-color: #2c3e50; color: #ecf0f1; font-size: 0.9em; } /* Responsive Anpassungen */ @media (max-width: 768px) { .category-grid { grid-template-columns: 1fr; } main { margin: 10px; padding: 15px; } table th, table td { padding: 8px 10px; font-size: 0.9em; } header h1 {font-size: 2em; } } /* Spezielle Stile für Single-Page Dynamic Content */ #gamePageContent { display: none; /* Standardmäßig ausgeblendet, wird sichtbar, wenn eine Kategorie ausgewählt ist */ } #homePageContent { display: block; /* Standardmäßig sichtbar */ } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;header&gt; &lt;h1 id="mainHeaderTitle"&gt;Spiele-Ranglisten Übersicht&lt;/h1&gt; &lt;nav id="mainNav"&gt; &lt;/nav&gt; &lt;/header&gt; &lt;main&gt; &lt;div id="homePageContent"&gt; &lt;sectionclass="game-categories"&gt; &lt;h2&gt;Spiele-Kategorien&lt;/h2&gt; &lt;div class="category-grid"&gt; &lt;/div&gt; &lt;/section&gt; &lt;sectionclass="overall-leaderboard"&gt; &lt;h2&gt;Gesamt-Rangliste (Alle Spiele)&lt;/h2&gt; &lt;table id="overallLeaderboardTable"&gt;&lt;thead&gt; &lt;tr&gt; &lt;th&gt;Rang&lt;/th&gt; &lt;th&gt;Spieler&lt;/th&gt; &lt;th&gt;Siege&lt;/th&gt; &lt;th&gt;Unentschieden&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt;&lt;/tbody&gt; &lt;/table&gt; &lt;p id="noOverallDataMessage" style="display: none; text-align: center; margin-top: 20px;"&gt; Noch keine Gesamt-Spielergebnisse vorhanden. &lt;/p&gt; &lt;/section&gt; &lt;/div&gt; &lt;div id="gamePageContent"&gt; &lt;sectionclass="category-leaderboard"&gt; &lt;h2 id="categoryLeaderboardTitle"&gt;&lt;/h2&gt; &lt;table id="categoryLeaderboardTable"&gt;&lt;thead&gt; &lt;tr&gt; &lt;th&gt;Rang&lt;/th&gt; &lt;th&gt;Spieler&lt;/th&gt; &lt;th&gt;Siege&lt;/th&gt; &lt;th&gt;Unentschieden&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt;&lt;/tbody&gt; &lt;/table&gt; &lt;p id="noCategoryDataMessage" style="display: none; text-align: center; margin-top: 20px;"&gt; Noch keine Spielergebnisse in dieser Kategorie vorhanden. &lt;/p&gt; &lt;/section&gt; &lt;section class="game-history"&gt; &lt;h2id="gameHistoryTitle"&gt;&lt;/h2&gt; &lt;div id="gameHistoryContainer"&gt; &lt;table id="gameHistoryTable"&gt; &lt;thead&gt; &lt;tr&gt;&lt;th&gt;Datum&lt;/th&gt; &lt;th&gt;Gewinner&lt;/th&gt; &lt;th&gt;Verlierer&lt;/th&gt; &lt;th&gt;Ergebnis&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody&gt; &lt;/tbody&gt;&lt;/table&gt; &lt;p id="noHistoryDataMessage" style="display: none; text-align: center; margin-top: 20px;"&gt; Noch keine Spiele in der Historie. &lt;/p&gt; &lt;/div&gt; &lt;/section&gt; &lt;section class="admin-section"&gt; &lt;h2&gt;Neues Spielergebnis eintragen (Admin)&lt;/h2&gt; &lt;div class="admin-login"&gt; &lt;label for="adminPassword"&gt;Admin-Passwort:&lt;/label&gt; &lt;inputtype="password" id="adminPassword" placeholder="Passwort eingeben"&gt; &lt;button id="loginButton"&gt;Login&lt;/button&gt;&lt;p id="loginMessage" class="error-message" style="display: none;"&gt;&lt;/p&gt; &lt;/div&gt; &lt;form id="addGameForm"style="display: none;"&gt; &lt;label for="winnerSelect"&gt;Gewinner:&lt;/label&gt; &lt;select id="winnerSelect" required&gt; &lt;optionvalue=""&gt;Spieler auswählen...&lt;/option&gt; &lt;/select&gt; &lt;label for="loserSelect"&gt;Verlierer:&lt;/label&gt; &lt;select id="loserSelect"required&gt; &lt;option value=""&gt;Spieler auswählen...&lt;/option&gt; &lt;option value="unentschieden"&gt;Unentschieden&lt;/option&gt;&lt;/select&gt; &lt;button type="submit"&gt;Ergebnis eintragen&lt;/button&gt; &lt;p id="formMessage" class="error-message"style="display: none;"&gt;&lt;/p&gt; &lt;/form&gt; &lt;/section&gt; &lt;/div&gt; &lt;/main&gt; &lt;footer&gt; &lt;p&gt;&amp;copy; 2025 Meine Ranglisten App&lt;/p&gt; &lt;/footer&gt; &lt;script&gt; // Ihre Firebase-Konfiguration const firebaseConfig = { apiKey: "AIzaSyARfEjjxhrHF1ALVX2ct_hf16VlNOTbJzA", authDomain: "test-app-9a6e3.firebaseapp.com", projectId: "test-app-9a6e3", storageBucket: "test-app-9a6e3.firebasestorage.app", messagingSenderId: "43393001620", appId: "1:43393001620:web:66758872241d314141ac81" }; firebase.initializeApp(firebaseConfig); const db = firebase.firestore(); // Admin-Passwort-Hash (MD5 von "admin123") - NICHT SICHER! Nur für Testzwecke! constADMIN_PASSWORD_HASHED = "a8f331d27931885b542031a084ef75f2"; let currentCategory = ''; consthomePageContent = document.getElementById('homePageContent'); const gamePageContent = document.getElementById('gamePageContent'); const mainHeaderTitle = document.getElementById('mainHeaderTitle'); const mainNav = document.getElementById('mainNav');document.addEventListener('DOMContentLoaded', () =&gt; { renderHomePage(); // Startet die Anwendung auf der Startseite // Klickevents für die Kategorie-Karten delegieren (für dynamisches Laden der Spielseiten) constcategoryGrid = document.querySelector('.category-grid'); categoryGrid.addEventListener('click', (event) =&gt; { constcard = event.target.closest('.category-card'); if (card) { event.preventDefault(); // Verhindert Standard-Link-Verhaltenconst categoryId = card.dataset.categoryId; renderGamePage(categoryId); } }); }); // --- SPA Rendering Funktionen ---function renderHomePage() { homePageContent.style.display = 'block'; gamePageContent.style.display = 'none'; mainHeaderTitle.textContent = 'Spiele-Ranglisten Übersicht'; mainNav.innerHTML = ''; // Keinen Zurück-Button auf der Startseite document.getElementById('pageTitle').textContent = 'Meine Spiele-Ranglisten'; createCategoryCards(); // Erstellt die dynamischen Kategoriekarten loadOverallLeaderboard(); // Lädt die Gesamt-Rangliste } async functionrenderGamePage(category) { currentCategory = category; homePageContent.style.display = 'none'; gamePageContent.style.display = 'block'; const displayName = getCategoryDisplayName(currentCategory); mainHeaderTitle.textContent = displayName; document.getElementById('pageTitle').textContent = `${displayName}Rangliste`; // Fügt den Zurück-Button hinzu mainNav.innerHTML = `&lt;a href="#" class="back-button" id="backToHome"&gt;&amp;larr; Zurück zur Übersicht&lt;/a&gt;`;document.getElementById('backToHome').addEventListener('click', (e) =&gt; { e.preventDefault(); renderHomePage(); }); // Aktualisiert die Kategorie-Namen auf der Seitedocument.getElementById('categoryLeaderboardTitle').textContent = `Rangliste für ${displayName}`;document.getElementById('gameHistoryTitle').textContent = `Spiel-Historie für ${displayName}`; awaitloadCategoryData(currentCategory); // Lädt Rangliste und Historie für die Kategorie setupAdminLogin(); // Initialisiert den Admin-Login setupAddGameForm(); // Initialisiert das Formular zum Eintragen von Ergebnissen } // Hilfsfunktion zur Umwandlung von game1 in "Spiel 1" etc. function getCategoryDisplayName(categoryId) { const num = categoryId.replace('game', ''); return `Spiel ${num}`; } // Erstellt dynamisch die Kategorie-Karten auf der Startseitefunction createCategoryCards() { const categoryGrid = document.querySelector('.category-grid'); categoryGrid.innerHTML = ''; // Entfernt vorherige Karten, falls vorhanden for (let i = 1; i &lt;= 4; i++) { const categoryId = `game${i}`; const displayName = getCategoryDisplayName(categoryId); const cardHtml = ` &lt;a href="#" class="category-card" data-category-id="${categoryId}"&gt; &lt;h3&gt;${displayName}&lt;/h3&gt; &lt;p&gt;Hier geht's zur Rangliste und zum Eintragen der Ergebnisse für ${displayName}.&lt;/p&gt; &lt;/a&gt; `; categoryGrid.insertAdjacentHTML('beforeend', cardHtml); } } // --- Ladefunktionen für Rangliste und Historie --- async function loadOverallLeaderboard() { constleaderboardTableBody = document.getElementById('overallLeaderboardTable').querySelector('tbody'); constnoDataMessage = document.getElementById('noOverallDataMessage'); leaderboardTableBody.innerHTML = ''; // Leert die Tabelle vor dem Laden try { const overallLeaderboardRef = db.collection('overallLeaderboard'); constsnapshot = await overallLeaderboardRef.orderBy('gesamt_siege', 'desc').get(); if (snapshot.empty) { noDataMessage.style.display = 'block'; return; } else { noDataMessage.style.display = 'none'; } let rank = 1; snapshot.forEach(doc =&gt; { const data = doc.data(); const playerName = doc.id; const totalWins = data.gesamt_siege || 0; const totalDraws = data.gesamt_unentschieden || 0; const row = leaderboardTableBody.insertRow(); row.insertCell().textContent = rank++; row.insertCell().textContent = playerName; row.insertCell().textContent = totalWins; row.insertCell().textContent = totalDraws; }); } catch (error) { console.error("Fehler beim Laden der Gesamt-Rangliste: ", error); alert("Es gab einen Fehler beim Laden der Gesamt-Rangliste. Bitte versuchen Sie es später erneut."); } } async function loadCategoryData(category) { await loadCategoryLeaderboard(category); awaitloadGameHistory(category); await populatePlayerSelects(category); // Füllt die Spieler-Dropdown-Listen } asyncfunction loadCategoryLeaderboard(category) { const leaderboardTableBody = document.getElementById('categoryLeaderboardTable').querySelector('tbody'); const noDataMessage = document.getElementById('noCategoryDataMessage'); leaderboardTableBody.innerHTML = ''; try { constcategoryPlayersRef = db.collection('spielerkategorien').doc(category).collection('spieler'); const snapshot = awaitcategoryPlayersRef.orderBy('siege', 'desc').get(); if (snapshot.empty) { noDataMessage.style.display = 'block'; return; } else { noDataMessage.style.display = 'none'; } let rank = 1; snapshot.forEach(doc =&gt; { const data = doc.data(); constplayerName = doc.id; const wins = data.siege || 0; const draws = data.unentschieden || 0; const row = leaderboardTableBody.insertRow(); row.insertCell().textContent = rank++; row.insertCell().textContent = playerName; row.insertCell().textContent = wins; row.insertCell().textContent = draws; }); } catch (error) { console.error(`Fehler beim Laden der Rangliste für ${category}: `, error); alert("Es gab einen Fehler beim Laden der Kategorie-Rangliste. Bitte versuchen Sie es später erneut."); } } async function loadGameHistory(category) { const gameHistoryTableBody = document.getElementById('gameHistoryTable').querySelector('tbody'); const noHistoryDataMessage = document.getElementById('noHistoryDataMessage'); gameHistoryTableBody.innerHTML = ''; try { constgameHistoryRef = db.collection('spielerkategorien').doc(category).collection('spiele_historie'); const snapshot = awaitgameHistoryRef.orderBy('datum', 'desc').get(); if (snapshot.empty) { noHistoryDataMessage.style.display = 'block';return; } else { noHistoryDataMessage.style.display = 'none'; } snapshot.forEach(doc =&gt; { const data = doc.data(); // Stellt sicher, dass das Datum ein Firestore-Timestamp ist und korrekt formatiert wird const date = data.datum instanceof firebase.firestore.Timestamp ? data.datum.toDate().toLocaleDateString() : 'N/A'; const winner = data.gewinner || 'N/A'; const loser = data.verlierer || 'N/A'; const result = winner === 'unentschieden' ? `${data.spieler1}vs ${data.spieler2} (Unentschieden)` : `${winner} schlägt ${loser}`; const row = gameHistoryTableBody.insertRow(); row.insertCell().textContent = date; row.insertCell().textContent = winner === 'unentschieden' ? data.spieler1 : winner; row.insertCell().textContent = winner === 'unentschieden' ? data.spieler2 : loser; row.insertCell().textContent = result; }); } catch (error) { console.error(`Fehler beim Laden der Spiel-Historie für ${category}: `, error); alert("Es gab einen Fehler beim Laden der Spiel-Historie. Bitte versuchen Sie es später erneut."); } } // --- Admin-Login und Formular-Setup --- function setupAdminLogin() { const loginButton = document.getElementById('loginButton'); constadminPasswordInput = document.getElementById('adminPassword'); const loginMessage = document.getElementById('loginMessage'); const addGameForm = document.getElementById('addGameForm'); // Setzt den Anfangszustand zurück addGameForm.style.display = 'none'; loginMessage.style.display = 'none'; adminPasswordInput.value = ''; // Stellt sicher, dass der Event Listener nur einmal hinzugefügt wird if(!loginButton.dataset.listenerAdded) { loginButton.addEventListener('click', () =&gt; { const enteredPassword = adminPasswordInput.value; const hashedEnteredPassword = CryptoJS.MD5(enteredPassword).toString(); // MD5-Hash des eingegebenen Passworts if (hashedEnteredPassword === ADMIN_PASSWORD_HASHED) { loginMessage.style.display = 'none'; addGameForm.style.display = 'flex'; // Zeigt das Formular anadminPasswordInput.value = ''; // Leert das Passwortfeld alert("Admin-Login erfolgreich!"); } else { loginMessage.textContent = 'Falsches Passwort. Bitte versuchen Sie es erneut.'; loginMessage.classList.remove('success-message'); loginMessage.classList.add('error-message'); loginMessage.style.display = 'block'; } }); loginButton.dataset.listenerAdded = true; } } async functionpopulatePlayerSelects(category) { const winnerSelect = document.getElementById('winnerSelect'); const loserSelect = document.getElementById('loserSelect'); winnerSelect.innerHTML = '&lt;option value=""&gt;Spieler auswählen...&lt;/option&gt;'; loserSelect.innerHTML = '&lt;option value=""&gt;Spieler auswählen...&lt;/option&gt;&lt;option value="unentschieden"&gt;Unentschieden&lt;/option&gt;'; try { const playersRef = db.collection('spielerkategorien').doc(category).collection('spieler'); const snapshot = await playersRef.get(); constplayers = []; snapshot.forEach(doc =&gt; { players.push(doc.id); }); // Fügt Platzhalter für neue Spieler hinzu for (let i = 1; i &lt;= 5; i++) { players.push(`Neuer Spieler ${i}`); } players.sort((a, b) =&gt; a.localeCompare(b)); // Sortiert Spieler alphabetisch players.forEach(player =&gt; { const optionWinner = document.createElement('option'); optionWinner.value = player; optionWinner.textContent = player; winnerSelect.appendChild(optionWinner); // "Neue Spieler X" können nicht als Verlierer ausgewählt werden if (!player.startsWith('Neuer Spieler')) { const optionLoser = document.createElement('option'); optionLoser.value = player; optionLoser.textContent = player; loserSelect.appendChild(optionLoser); } }); } catch (error) { console.error("Fehler beim Füllen der Spieler-Dropdowns: ", error); } } function setupAddGameForm() { const addGameForm = document.getElementById('addGameForm');const winnerSelect = document.getElementById('winnerSelect'); const loserSelect = document.getElementById('loserSelect'); const formMessage = document.getElementById('formMessage'); // Setzt den Anfangszustand zurück formMessage.style.display = 'none'; formMessage.textContent = ''; addGameForm.reset(); // Stellt sicher, dass der Event Listener nur einmal hinzugefügt wird if (!addGameForm.dataset.listenerAdded) { addGameForm.addEventListener('submit', async (e) =&gt; { e.preventDefault(); const winnerName = winnerSelect.value.trim(); let loserName = loserSelect.value.trim(); if (!winnerName || !loserName) { formMessage.textContent = 'Bitte Gewinner und Verlierer auswählen.'; formMessage.classList.remove('success-message'); formMessage.classList.add('error-message'); formMessage.style.display = 'block'; return; } if (winnerName === loserName &amp;&amp; loserName !== 'unentschieden') { formMessage.textContent = 'Gewinner und Verlierer können nicht dieselbe Person sein (außer bei Unentschieden).'; formMessage.classList.remove('success-message'); formMessage.classList.add('error-message'); formMessage.style.display = 'block'; return; } formMessage.style.display = 'none'; formMessage.textContent = ''; // Setzt die Nachricht zurück // Behandelt "Neuer Spieler X" Eingaben constfinalWinnerName = winnerName.startsWith('Neuer Spieler') ? prompt("Bitte geben Sie den Namen des neuen Gewinner-Spielers ein:") : winnerName; let finalLoserName = loserName; if (loserName.startsWith('Neuer Spieler')) { finalLoserName = prompt("Bitte geben Sie den Namen des neuen Verlierer-Spielers ein:"); } if (!finalWinnerName || (finalLoserName !== 'unentschieden' &amp;&amp; !finalLoserName)) { formMessage.textContent = 'Spielername(n) dürfen nicht leer sein.'; formMessage.classList.remove('success-message'); formMessage.classList.add('error-message'); formMessage.style.display = 'block'; return; } try { await addGameResult(finalWinnerName, finalLoserName, currentCategory); formMessage.textContent = 'Ergebnis erfolgreich eingetragen!'; formMessage.classList.remove('error-message'); formMessage.classList.add('success-message'); formMessage.style.display = 'block'; // Lädt Ranglisten neu und aktualisiert Dropdowns awaitloadCategoryData(currentCategory); addGameForm.reset(); // Setzt das Formular zurück awaitpopulatePlayerSelects(currentCategory); // Füllt Dropdowns neu } catch (error) { console.error("Fehler beim Eintragen des Ergebnisses: ", error); formMessage.textContent = `Fehler beim Eintragen des Ergebnisses: ${error.message}`; formMessage.classList.remove('success-message'); formMessage.classList.add('error-message'); formMessage.style.display = 'block'; } }); addGameForm.dataset.listenerAdded = true; } } // --- Logik zum Hinzufügen von Spielergebnissen zu Firebase --- async function addGameResult(winner, loser, category) { const batch = db.batch(); // Verwendet Batch-Writes für atomare Updates const categoryRef = db.collection('spielerkategorien').doc(category);const categoryPlayersRef = categoryRef.collection('spieler'); const gameHistoryRef = categoryRef.collection('spiele_historie'); const overallLeaderboardRef = db.collection('overallLeaderboard'); // 1. Spiel zur Historie hinzufügen const gameId = gameHistoryRef.doc().id; const gameData = { datum: firebase.firestore.FieldValue.serverTimestamp(), kategorie: category, gewinner: winner, }; if (loser === 'unentschieden') { // Unentschieden-Fall gameData.gewinner = 'unentschieden'; gameData.spieler1 = winner; gameData.spieler2 = prompt(`Unentschieden zwischen ${winner} und welchem anderen Spieler?`); if (!gameData.spieler2) { throw newError("Bitte geben Sie den Namen des zweiten Spielers für das Unentschieden ein."); } gameData.verlierer = 'N/A'; gameData.punkte_spieler1 = 1; gameData.punkte_spieler2 = 1; // Spieler 1 in Kategorie aktualisieren constplayer1DocRef = categoryPlayersRef.doc(gameData.spieler1); batch.set(player1DocRef, { siege: firebase.firestore.FieldValue.increment(0), unentschieden: firebase.firestore.FieldValue.increment(1) }, { merge: true });// Spieler 2 in Kategorie aktualisieren const player2DocRef = categoryPlayersRef.doc(gameData.spieler2); batch.set(player2DocRef, { siege: firebase.firestore.FieldValue.increment(0), unentschieden: firebase.firestore.FieldValue.increment(1) }, { merge: true }); // Spieler 1 in Gesamt aktualisieren constoverallPlayer1DocRef = overallLeaderboardRef.doc(gameData.spieler1); batch.set(overallPlayer1DocRef, { gesamt_siege: firebase.firestore.FieldValue.increment(0), gesamt_unentschieden: firebase.firestore.FieldValue.increment(1) }, { merge: true }); // Spieler 2 in Gesamt aktualisieren constoverallPlayer2DocRef = overallLeaderboardRef.doc(gameData.spieler2); batch.set(overallPlayer2DocRef, { gesamt_siege: firebase.firestore.FieldValue.increment(0), gesamt_unentschieden: firebase.firestore.FieldValue.increment(1) }, { merge: true }); } else { // Normaler Gewinn-Fall gameData.verlierer = loser; gameData.punkte_gewinner = 2; // Gewinner erhält 2 Punkte (Regel "ganz gewinnen zwei")gameData.punkte_verlierer = 0; // Verlierer erhält 0 Punkte // Gewinner in Kategorie aktualisieren const winnerDocRef = categoryPlayersRef.doc(winner); batch.set(winnerDocRef, { siege: firebase.firestore.FieldValue.increment(1), unentschieden: firebase.firestore.FieldValue.increment(0) }, { merge: true }); // Verlierer in Kategorie aktualisierenconst loserDocRef = categoryPlayersRef.doc(loser); batch.set(loserDocRef, { siege: firebase.firestore.FieldValue.increment(0), unentschieden: firebase.firestore.FieldValue.increment(0) }, { merge: true });// Gewinner in Gesamt aktualisieren const overallWinnerDocRef = overallLeaderboardRef.doc(winner); batch.set(overallWinnerDocRef, { gesamt_siege: firebase.firestore.FieldValue.increment(1), gesamt_unentschieden: firebase.firestore.FieldValue.increment(0) }, { merge: true }); // Verlierer in Gesamt aktualisieren constoverallLoserDocRef = overallLeaderboardRef.doc(loser); batch.set(overallLoserDocRef, { gesamt_siege: firebase.firestore.FieldValue.increment(0), gesamt_unentschieden: firebase.firestore.FieldValue.increment(0) }, { merge: true }); } batch.set(gameHistoryRef.doc(gameId), gameData); // Fügt Spieldaten dem Batch hinzu // Führt alle Batch-Operationen aus await batch.commit(); } &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</span></p>
</body>
</html>
