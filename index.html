
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Gambling App ‚Äì GitHub-kompatibel</title>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore-compat.js"></script>
</head>
<body style="background:#000;color:#fff;font-family:sans-serif;text-align:center;padding:20px;">
  <h1>üé≤ Gambling App</h1>
  <div>
    <input id="adminPass" type="password" placeholder="Admin Passwort" />
    <button onclick="loginAdmin()">Login</button>
    <p id="adminStatus"></p>
  </div>
  <div id="adminPanel" style="display:none;">
    <h2>Ergebnis eintragen</h2>
    <select id="gameType">
      <option>Kniffel</option>
      <option>Watten</option>
      <option>Arschloch</option>
    </select>
    <input id="winners" placeholder="z.‚ÄØB. Max, Anna" />
    <button onclick="submitResult()">Eintragen</button>
    <p id="status"></p>
    <h2>Spieler zusammenf√ºhren</h2>
    <select id="fromName"></select>
    <select id="toName"></select>
    <button onclick="mergePlayers()">Zusammenf√ºhren</button>
    <p id="mergeStatus"></p>
  </div>
  <h2>Spielerstatistik</h2>
  <table border="1" style="margin:auto;margin-top:20px;" id="statsTable">
    <thead>
      <tr><th>Spieler</th><th>Spiele</th><th>Siege</th><th>Geld (‚Ç¨)</th><th>Siegquote (%)</th></tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDy68MUU2CV9-tCsu9qbKBd7NEL-MGNxX0",
  authDomain: "gambling-app-24-7.firebaseapp.com",
  projectId: "gambling-app-24-7",
  storageBucket: "gambling-app-24-7.appspot.com",
  messagingSenderId: "929710119993",
  appId: "1:929710119993:web:b4678cc49c503c332701e8"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const PASSWORD = "admin123";
let stats = {};

async function loadStats() {
  const snapshot = await db.collection("spieler").get();
  snapshot.forEach(doc => {
    stats[doc.id] = doc.data();
  });
  updateTable();
}
loadStats();

function updateTable() {
  const tbody = document.querySelector("#statsTable tbody");
  const fromSel = document.getElementById("fromName");
  const toSel = document.getElementById("toName");
  tbody.innerHTML = ""; fromSel.innerHTML = ""; toSel.innerHTML = "";

  for (let name in stats) {
    const { games, wins, money } = stats[name];
    const quote = games > 0 ? ((wins / games) * 100).toFixed(1) : "0.0";
    tbody.innerHTML += `<tr><td>${name}</td><td>${games}</td><td>${wins}</td><td>${money}</td><td>${quote}</td></tr>`;
    const opt1 = new Option(name, name);
    const opt2 = new Option(name, name);
    fromSel.add(opt1); toSel.add(opt2);
  }
}

function loginAdmin() {
  const pass = document.getElementById("adminPass").value;
  const stat = document.getElementById("adminStatus");
  if (pass === PASSWORD) {
    document.getElementById("adminPanel").style.display = "block";
    stat.textContent = "‚úÖ Zugriff gew√§hrt";
  } else {
    stat.textContent = "‚ùå Falsches Passwort";
  }
}

async function submitResult() {
  const game = document.getElementById("gameType").value;
  const winners = document.getElementById("winners").value.trim().split(",").map(x => x.trim());
  const allPlayers = new Set(winners.concat(Object.keys(stats)));

  for (let name of allPlayers) {
    if (!stats[name]) stats[name] = { games: 0, wins: 0, money: 0 };
    stats[name].games++;
  }

  if ((game === "Kniffel" || game === "Arschloch") && winners.length === 1) {
    stats[winners[0]].wins++;
    for (let name of allPlayers) {
      if (name !== winners[0]) stats[name].money -= 5;
    }
    stats[winners[0]].money += 5 * (allPlayers.size - 1);
  }

  if (game === "Watten" && winners.length === 2) {
    winners.forEach(w => {
      stats[w].wins++;
      stats[w].money += 5 * ((allPlayers.size - 2) / 2);
    });
    allPlayers.forEach(p => {
      if (!winners.includes(p)) stats[p].money -= 5;
    });
  }

  for (let name in stats) {
    await db.collection("spieler").doc(name).set(stats[name]);
  }

  updateTable();
  document.getElementById("status").textContent = "‚úÖ Ergebnis gespeichert";
}

async function mergePlayers() {
  const from = document.getElementById("fromName").value;
  const to = document.getElementById("toName").value;
  const stat = document.getElementById("mergeStatus");

  if (from === to) return stat.textContent = "‚ö†Ô∏è Gleiche Namen";
  if (!stats[from] || !stats[to]) return stat.textContent = "‚ö†Ô∏è Ung√ºltige Auswahl";

  stats[to].games += stats[from].games;
  stats[to].wins += stats[from].wins;
  stats[to].money += stats[from].money;
  delete stats[from];

  await db.collection("spieler").doc(to).set(stats[to]);
  await db.collection("spieler").doc(from).delete();

  updateTable();
  stat.textContent = "‚úÖ Spieler zusammengef√ºhrt";
}
</script>
</body>
</html>
